<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Alcaide</title>
  <link rel="stylesheet" href="css/bootstrapmuro.css">
  <link rel="stylesheet" href="css/disseny.css">

<!-- Favicon -->
    <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

  <script type="text/javascript">
  var p = 0;

  var celdas = ["myCanvas0","myCanvas1","myCanvas2","myCanvas3","myCanvas4","myCanvas5","myCanvas6","myCanvas7","myCanvas8","myCanvas9","myCanvas10","myCanvas11","myCanvas12","myCanvas13","myCanvas14","myCanvas15","myCanvas16","myCanvas17","myCanvas18","myCanvas19","myCanvas20","myCanvas21","myCanvas22","myCanvas23","myCanvas24","myCanvas25","myCanvas26","myCanvas27","myCanvas28","myCanvas29"];


      function ss(x,i){
        var canvas = document.getElementById(x);
        var celda = canvas.getContext("2d");
        celda.font="100px quicksand";
        celda.fillText(i,110,110);
        celda.textAlign="center";
      }

    function escribir(){
      var x = 0;
      celdas.forEach(function(i){  
        ss(i,x);
        x++
      });
    }

</script>

  </head>

<body onLoad="escribir();">

  <div class="container-fluid" style="height:100%; background-color: #b2dfdb">
    <div class="row" style="padding:0px">
      <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3" style=" margin-top: 0%; height:100%; padding:0px; background-color:#80cbc4;">

      <div style="position:fixed;width:22%; margin-top:10%">
      <img src="images/carsel.jpg" alt="..." class="img-rounded" style="width:95%; margin-bottom:6%;margin-top:2%;margin-left:10%;margin-top:12%">

    <div class="jumbotron" style="background-color:#80cbc4; padding:5px;margin:5px;">

            <h4 class="titol" style="margin-left:10%; margin-bottom:12%;">Presó de Quatre Camins</h4>
      
              <h4 class="titol" style="margin-left:10%; margin-bottom:12%;">90 cel·les totals</h4>
              <h4 class="titol" style="margin-left:10%; margin-bottom:12%;">28 disponibles</h4>
  </div>
  </div>
  </div>


      <div class="col-lg-9 col-md-9 col-sm-9 col-xs-9" style= "padding-left:10px; padding-top: 10;height:100%;">

       <div class="row" style="padding-top:2%">
      <div class="col-lg-8  col-md-8 col-sm-8 col-xs-8">
      </div>

      <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">

      <div class="dropdown" style="padding-top:10%;">
    <button class="btn btn-info dropdown-toggle" type="button" data-toggle="dropdown" style="width:100%; ">Gestió
    <span class="caret"></span></button>
    <ul class="dropdown-menu dropdown-menu-right">
      <li class="dropdown-header"><strong>Residents</strong></li>
      <li><a href="afegirresident.html">Afegeix resident</a></li>
      <li class="divider"></li>
      <li class="dropdown-header"><strong>Treballadors</strong></li>
      <li><a href="afegirtreballador.html">Afegeix treballador</a></li>
      <li class="divider"></li>
      <li class="divider"></li>
      <li class="dropdown-header"><strong>Més informació</strong></li>
      <li><a href="#">Qui som?</a></li>
    </ul>
  </div>
  </div>
  <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
  <a href="gracias.html">
  <img src="images/logout.png" alt="..." class="img-rounded" style="width:50%;height:4%;margin-top:11%;margin-left:20%">
  </a>
  </div>


  </div>


<div id="mapa" class="jumbotron" style=" background-color:#b2dfdb; padding:1%; padding-top: 1%;  margin-bottom:1%;margin-top:2%;">
        
  <div id="nis" class="panel panel-info" style=" padding-bottom:2%; margin-bottom:0%;background-color:#e0f2f1;">

      <div class="panel-heading">CONTROL DE LES CEL·LES</div>
      <div id="lastcaida" class="panel-body">

      <div class="row" style="padding-top:2%">
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
        <div>

<canvas id="myCanvas0" class="puertacerrada" onclick="gestioceldas(0)"></canvas></div>
      </div>
<div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas1" class="puertacerrada" onclick="gestioceldas(1)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas2" class="puertacerrada" onclick="gestioceldas(2)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas3" class="puertaabierta" onclick="gestioceldas(3)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas4" class="puertacerrada" onclick="gestioceldas(4)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas5" class="puertacerrada" onclick="gestioceldas(5)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas6" class="puertacerrada" onclick="gestioceldas(6)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas7" class="puertaabierta" onclick="gestioceldas(7)">></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas8" class="puertaabierta" onclick="gestioceldas(8)">></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas9" class="puertaabierta" onclick="gestioceldas(9)">></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas10" class="puertacerrada" onclick="gestioceldas(10)">></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas11" class="puertaabierta" onclick="gestioceldas(11)">></canvas>
      </div>
  	</div>


  	<div class="row" style="padding-top:2%">
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas12" class="puertacerrada" onclick="gestioceldas(12)"></canvas>
      </div>
      <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10">
      <div id="numcelda">
      </div>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas13" class="puertacerrada" onclick="gestioceldas(13)"></canvas>
      </div>
    </div>

    <div class="row" style="padding-top:2%">
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas14" class="puertacerrada" onclick="gestioceldas(14)"></canvas>
      </div>
      <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10">
        <div id="numsector">
        <h2 class="titol" id="DadesPersonals" style="margin:0px;">Cel·les del sector X</h2></div>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas15" class="puertacerrada" onclick="gestioceldas(15)"></canvas>
      </div>
    </div>

    <div class="row" style="padding-top:2%">
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas16" class="puertacerrada" onclick="gestioceldas(16)"></canvas>
      </div>
      <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10">
        <div id="dispositius">
        </div>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas17" class="puertaabierta" onclick="gestioceldas(17)"></canvas>
      </div>
    </div>



<div class="row" style="padding-top:2%">
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas18" class="puertacerrada" onclick="gestioceldas(18)"></canvas>
      </div>
<div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas19" class="puertaabierta" onclick="gestioceldas(19)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas20" class="puertaabierta" onclick="gestioceldas(20)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas21" class="puertaabierta" onclick="gestioceldas(21)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas22" class="puertacerrada" onclick="gestioceldas(22)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas23" class="puertaabierta" onclick="gestioceldas(23)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas24" class="puertacerrada" onclick="gestioceldas(24)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas25" class="puertacerrada" onclick="gestioceldas(25)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas26" class="puertacerrada" onclick="gestioceldas(26)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas27" class="puertacerrada" onclick="gestioceldas(27)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
<canvas id="myCanvas28" class="puertacerrada" onclick="gestioceldas(28)"></canvas>
      </div>
      <div class="col-lg-1  col-md-1 col-sm-1 col-xs-1">
        <div>
<canvas id="myCanvas29" class="puertacerrada" onclick="gestioceldas(29)"></canvas></div>
      </div>
  	</div>
      </div>
    </div>
     </div>



     <div class="jumbotron" style=" background-color:#b2dfdb; padding:0%; padding-top: 1%;  margin-bottom:3%;margin-top:0%;">
        
  <div id="luz" class="panel panel-info" style=" padding-bottom:0%; margin-bottom:0%;background-color:#e0f2f1;">

     <div class="panel-heading">ILUMINACIÓ GENERAL</div>
      <div class="panel-body">
        <label class="switch">
  <input type="checkbox">
  <div class="slider round"></div>
</label> <h3 class="titol" style="width:70%;float:right;margin-top:0%;">Encén/apaga les llums de tot el sector</h3>
      </div>
    </div>
  </div>
</div> </div>



      </div>
    
  
  <script>

    setInterval("leerceldas()",1000);


    function gestioceldas(n){

      var xmlhttp = new XMLHttpRequest();
      var url = "http://192.168.1.14:8000/sector/"+p+"";
      xmlhttp.onreadystatechange=
      function() {
      if (this.readyState == 4 && this.status == 200){
      var my = this.response;
      infocelda(my,n);
      }
    };
    xmlhttp.open("GET", url);
    xmlhttp.responseType= "json";
    xmlhttp.send();
  }

  function infocelda(obj,n){
      if((obj.cceldas[n].llum)==0){
        var m = "APAGADES"
        var mm = "ENCÉN"
        var mmm = "ENCÉS"}

      else{
        var m = "ENCESES"
        var mm = "APAGA"
        var mmm = "APAGAT"
      }
      if((obj.cceldas[n].puerta)==0){
        var q = "TANCADA"
        var qq = "OBRE"
        var qqq = "OBERT"}
      else{
        var q = "OBERTA"
        var qq = "TANCA"
        var qqq = "TANCAT"
      }
      document.getElementById("numcelda").innerHTML = "<h3 class='titol' style='margin-top:1%;px;margin-bottom:0px;''> Cel·la número "+ String(n) + " del sector número "+p+".</h3>";
      document.getElementById("numsector").innerHTML = "<h4 class='titol' style='margin-top:0px;margin-bottom:0px;'> Cel·la ocupada per: "+ obj.cceldas[n].presos + ".<br> Llums "+m+" / Porta "+q+"</h4>";
     document.getElementById("dispositius").innerHTML = "<div class='row'><div class='col-lg-2 col-md-2 col-sm-2 col-xs-2'></div><div class='col-lg-4 col-md-4 col-sm-4 col-xs-4'><button class='button' onclick='llum("+n+","+mmm+")'>"+mm+" La Llum</button></div><div class='col-lg-6 col-md-6 col-sm-6 col-xs-6'><button class='button' onclick='porta("+n+","+qqq+")'>"+qq+" La Porta</button></div></div>";
     document.getElementById("nis").className = "" ;
    }


    function color(x) {
      obj = document.getElementById(x);
      obj.style.backgroundColor = '#FFFFFF';
    }

    function llum(n,mmm){
      //apagaaaaa/encen onetiii
      alert("¡Has "+mmm+" la llum de la cel·la "+String(n)+"!");
    }

    function porta(n,qqq){
      //....................
      alert("¡Has "+qqq+" la porta de la cel·la "+String(n)+"!");
    }

    function neteja(){
       document.getElementById("numcelda").innerHTML = "";
       document.getElementById("numsector").innerHTML = "<h2 class='titol' id='DadesPersonals' style='margin:0px;'>Cel·les del sector X</h2></div>";
       document.getElementById("dispositius").innerHTML = "";
    }




     $(document).on("click",function(e) {
                    
         var container = $("#mapa");
                            
            if (!container.is(e.target) && container.has(e.target).length === 0) { 
               neteja();               
            }
     });



 function leerceldas() {
    var xmlhttp = new XMLHttpRequest();
    var url = "http://192.168.1.14:8000/sector/"+p+"";
    xmlhttp.onreadystatechange=
    function() {
    if (this.readyState == 4 && this.status == 200){
    var my = this.response;
    var x = 0;
    celdas.forEach(function(i){
      colorea(i,x,my);
      x++
    });
    };
    xmlhttp.open("GET", url);
    xmlhttp.responseType= "json";
    xmlhttp.send();
    }
  }


function colorea(i,x,obj){
        if((obj.cceldas[x].puerta)==0){
          document.getElementById(i).className = "puertacerrada";
        }
        else{
          document.getElementById(i).className = "puertacerrada";
        }
      }
      </script>

</body>

</html>
